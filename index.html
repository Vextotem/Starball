<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Raket Sports</title>
<link rel="icon" href="https://cdn.jsdelivr.net/gh/Vextotem/Mycss@main/raketlogo.png">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:Segoe UI,Tahoma,Verdana,sans-serif;
    background:linear-gradient(135deg,#1a1a2e,#16213e);
    padding:10px;
    min-height:100vh
}
.container{
    max-width:1400px;
    margin:auto;
    background:#fff;
    border-radius:15px;
    box-shadow:0 20px 60px rgba(0,0,0,.4);
    overflow:hidden
}
.header{
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:#fff;
    padding:25px;
    text-align:center;
    cursor:pointer
}
.filters{
    padding:20px;
    background:#f8f9fa;
    border-bottom:1px solid #dee2e6
}
.filters input{
    width:100%;
    padding:12px;
    border:2px solid #dee2e6;
    border-radius:8px
}
.events{padding:25px}

.event-card{
    border:1px solid #e9ecef;
    border-radius:12px;
    padding:18px;
    margin-bottom:14px;
    transition:.2s
}
.event-card.live{
    border-left:5px solid #ff4444;
    background:#fff6f6
}
.event-card:hover{
    border-color:#667eea;
    transform:translateX(4px)
}
.event-header{
    display:flex;
    justify-content:space-between;
    gap:15px;
    flex-wrap:wrap
}
.match{
    display:flex;
    align-items:center;
    gap:12px
}
.league-logo{width:40px;height:40px;object-fit:contain}
.team-logo{width:26px;height:26px;object-fit:contain}
.teams{font-weight:700;font-size:1.1em}
.vs{color:#aaa;margin:0 6px}
.tournament{font-size:.9em;color:#666}
.badge{
    padding:5px 12px;
    border-radius:50px;
    font-size:.75em;
    font-weight:700;
    color:#fff
}
.badge.live{background:#ff4444}
.badge.sport{background:#667eea}
.badge.time{background:#28a745}

.channels{
    margin-top:12px;
    display:flex;
    gap:8px;
    flex-wrap:wrap
}
.channel-btn{
    padding:9px 16px;
    border-radius:6px;
    border:1px solid #ced4da;
    background:#f1f3f5;
    font-weight:600;
    cursor:pointer
}
.channel-btn:hover{
    background:#764ba2;
    color:#fff
}
.loading,.no-results{
    text-align:center;
    padding:50px;
    color:#777
}
</style>
</head>

<body>

<div class="header" onclick="location.reload()">
    <h1>Sports Events Live</h1>
    <p>Live • Football Priority • Local Timezone</p>
</div>

<div class="container">

<div class="filters">
    <input id="searchFilter" placeholder="Search teams or league">
</div>

<div class="events" id="events"></div>

</div>

<script>
const API_URL = 'https://beta.adstrim.ru/api/events';
const LIVE_DURATION_SECONDS = 3 * 60 * 60;
const USER_TIMEZONE = Intl.DateTimeFormat().resolvedOptions().timeZone;

let allEvents = [];

/* ===== LIVE CHECK (UTC SAFE) ===== */
function isLive(ts){
    const now = Math.floor(Date.now() / 1000);
    return ts > 0 && ts <= now && (now - ts) <= LIVE_DURATION_SECONDS;
}

/* ===== PRIORITY SORT ===== */
function sortEvents(events){
    const TOP_LEAGUES = [
        'premier league','champions league','europa league',
        'la liga','serie a','bundesliga','ligue 1'
    ];

    return [...events].sort((a,b)=>{
        const al = isLive(a.ts), bl = isLive(b.ts);
        if(al !== bl) return al ? -1 : 1;

        const af = /football|soccer/i.test(a.sport);
        const bf = /football|soccer/i.test(b.sport);
        if(af !== bf) return af ? -1 : 1;

        const at = TOP_LEAGUES.some(l => a.league.toLowerCase().includes(l));
        const bt = TOP_LEAGUES.some(l => b.league.toLowerCase().includes(l));
        if(at !== bt) return at ? -1 : 1;

        return (a.ts || Infinity) - (b.ts || Infinity);
    });
}

/* ===== LOAD EVENTS ===== */
async function load(){
    const container = document.getElementById('events');
    container.innerHTML = '<div class="loading">Loading events...</div>';

    const res = await fetch(API_URL).then(r => r.json());

    allEvents = (res.data || []).map(e => ({
        home: e.home_team || 'Unknown',
        away: e.away_team || 'Unknown',
        hLogo: e.home_team_image || '',
        aLogo: e.away_team_image || '',
        league: e.league || 'General',
        lLogo: e.league_image || '',
        sport: e.sport || 'Sports',
        ts: Number(e.timestamp) || 0,
        channels: (e.channels || []).map(c => ({
            name: c.name || 'Stream',
            url: c.link || '#'
        }))
    }));

    render();
}

/* ===== RENDER ===== */
function render(){
    const q = document.getElementById('searchFilter').value.toLowerCase();

    const list = sortEvents(
        allEvents.filter(e =>
            `${e.home} ${e.away} ${e.league}`.toLowerCase().includes(q)
        )
    );

    const el = document.getElementById('events');
    el.innerHTML = '';

    if(!list.length){
        el.innerHTML = '<div class="no-results">No events found</div>';
        return;
    }

    list.forEach(e=>{
        const live = isLive(e.ts);
        const time = new Date(e.ts * 1000).toLocaleTimeString(undefined,{
            hour:'2-digit',
            minute:'2-digit',
            timeZone: USER_TIMEZONE
        });

        el.innerHTML += `
        <div class="event-card ${live ? 'live' : ''}">
            <div class="event-header">
                <div class="match">
                    <img src="${e.lLogo}" class="league-logo">
                    <div>
                        <div class="teams">
                            <img src="${e.hLogo}" class="team-logo">
                            ${e.home}<span class="vs">vs</span>${e.away}
                            <img src="${e.aLogo}" class="team-logo">
                            ${live ? '<span class="badge live">LIVE</span>' : ''}
                        </div>
                        <div class="tournament">${e.league}</div>
                    </div>
                </div>
                <div>
                    <span class="badge sport">${e.sport}</span>
                    <span class="badge time">${time}</span>
                </div>
            </div>
            <div class="channels">
                ${e.channels.map(c => `
                    <button class="channel-btn">${c.name}</button>
                `).join('')}
            </div>
        </div>`;
    });
}

document.getElementById('searchFilter').addEventListener('input', render);
load();
</script>

</body>
</html>
