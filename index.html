<!DOCTYPE html>
<html lang="en">
<head>
    <script data-cfasync="false" async type="text/javascript" src="//ox.verdedagon.com/rw3ZGaqDrBoQ00x/104823"></script>
    <script data-cfasync="false" async type="text/javascript" src="//glinkhitler.com/gNOISgtbYKRUAFSF3/97239"></script>
    <meta content="never" name="referrer"/>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epicsports</title>
    <script>
        tailwind.config = { darkMode: 'media' };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
      <link rel="icon" href="https://cdn.jsdelivr.net/gh/Vextotem/Mycss@main/raketlogo.png" type="image/x-icon">
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .hover-elevate:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.15), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .active-elevate-2:active { transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 font-sans transition-colors">
    <div id="app" class="max-w-4xl mx-auto px-4 py-6">
        <!-- Header -->
        <header class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-bold flex items-center gap-2">
                <i data-lucide="play-circle" class="text-blue-500"></i>
                Epicsports.One
            </h1>
        </header>

        <!-- Search Bar -->
        <div class="mb-6 relative">
            <div class="relative">
                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-gray-500 pointer-events-none"></i>
                <input
                    id="search-input"
                    type="text"
                    placeholder="Search matches, teams..."
                    oninput="handleSearch(this.value)"
                    class="w-full pl-9 pr-9 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                />
                <button
                    id="search-clear"
                    onclick="clearSearch()"
                    class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 hidden"
                >
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
        </div>

        <!-- Sport Filter -->
        <div id="sport-filter-container" class="mb-8">
            <div id="sport-filter" class="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                <div class="animate-pulse flex gap-2">
                    <div class="h-8 w-24 bg-gray-200 dark:bg-gray-800 rounded-md"></div>
                    <div class="h-8 w-24 bg-gray-200 dark:bg-gray-800 rounded-md"></div>
                    <div class="h-8 w-24 bg-gray-200 dark:bg-gray-800 rounded-md"></div>
                    <div class="h-8 w-24 bg-gray-200 dark:bg-gray-800 rounded-md"></div>
                </div>
            </div>
        </div>

        <!-- Matches Grid -->
        <div id="matches-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="animate-pulse bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-800 h-32"></div>
            <div class="animate-pulse bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-800 h-32"></div>
            <div class="animate-pulse bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-800 h-32"></div>
            <div class="animate-pulse bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-800 h-32"></div>
        </div>
    </div>

    <!-- Match Detail Modal -->
    <div id="match-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                <i data-lucide="x"></i>
            </button>
            <div id="modal-content" class="p-6"></div>
        </div>
    </div>

    <script>
        const API_BASE = "https://streamed.pk/api";
        let currentSport = "all";
        let sports = [];
        let matches = [];
        let searchQuery = "";

        const darkMQ = window.matchMedia('(prefers-color-scheme: dark)');
        const isDark = () => darkMQ.matches;

        const sportIcons = {
            football: "circle", basketball: "dribbble", tennis: "target",
            hockey: "swords", mma: "swords", boxing: "swords",
            motorsport: "bike", cricket: "trophy", rugby: "volleyball", all: "trophy"
        };

        const categoryColors = {
            football: "bg-emerald-600", basketball: "bg-orange-600", tennis: "bg-yellow-600",
            hockey: "bg-sky-600", baseball: "bg-red-600", mma: "bg-purple-600",
            boxing: "bg-rose-600", cricket: "bg-lime-600", rugby: "bg-amber-600",
            motorsport: "bg-zinc-600", golf: "bg-teal-600", afl: "bg-indigo-600", darts: "bg-pink-600"
        };

        async function init() {
            lucide.createIcons();
            darkMQ.addEventListener('change', () => { renderSports(); renderMatches(); });
            await loadSports();
            await loadMatches("all");
        }

        async function loadSports() {
            try {
                const res = await fetch(`${API_BASE}/sports`);
                sports = await res.json();
                renderSports();
            } catch (err) { console.error("Failed to load sports", err); }
        }

        function renderSports() {
            const container = document.getElementById("sport-filter");
            const allSports = [{ id: "all", name: "All Sports" }, ...sports];
            const dark = isDark();

            container.innerHTML = allSports.map(sport => `
                <button
                    onclick="selectSport('${sport.id}')"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium whitespace-nowrap transition-colors flex-shrink-0 ${
                        currentSport === sport.id
                        ? (dark ? "bg-gray-100 text-gray-900" : "bg-gray-900 text-white")
                        : (dark ? "bg-gray-800 text-gray-300 hover:bg-gray-700" : "bg-gray-200 text-gray-600 hover:bg-gray-300")
                    }"
                >
                    <i data-lucide="${sportIcons[sport.id] || 'trophy'}" class="w-3.5 h-3.5"></i>
                    ${sport.name}
                </button>
            `).join("");
            lucide.createIcons();
        }

        async function selectSport(sportId) {
            currentSport = sportId;
            renderSports();
            await loadMatches(sportId);
        }

        async function loadMatches(sportId) {
            const grid = document.getElementById("matches-grid");
            const dark = isDark();
            grid.innerHTML = Array(4).fill(0).map(() => `
                <div class="animate-pulse ${dark ? 'bg-gray-900 border-gray-800' : 'bg-white border-gray-200'} p-4 rounded-lg border h-32"></div>
            `).join("");

            try {
                const endpoint = sportId === "all" ? "/matches/football" : `/matches/${sportId}`;
                const res = await fetch(`${API_BASE}${endpoint}`);
                matches = await res.json();
                renderMatches();
            } catch (err) {
                console.error("Failed to load matches", err);
                grid.innerHTML = `<p class="col-span-full text-center text-red-500 py-8">Failed to load matches. Please try again later.</p>`;
            }
        }

        function handleSearch(value) {
            searchQuery = value.trim().toLowerCase();
            document.getElementById("search-clear").classList.toggle("hidden", searchQuery === "");
            renderMatches();
        }

        function clearSearch() {
            const input = document.getElementById("search-input");
            input.value = "";
            handleSearch("");
            input.focus();
        }

        function getFilteredMatches() {
            if (!searchQuery) return matches;
            return matches.filter(match => {
                const homeName = (match.teams?.home?.name || match.title.split(" vs ")[0] || "").toLowerCase();
                const awayName = (match.teams?.away?.name || match.title.split(" vs ")[1] || "").toLowerCase();
                const title = (match.title || "").toLowerCase();
                const category = (match.category || "").toLowerCase();
                return homeName.includes(searchQuery) || awayName.includes(searchQuery) || title.includes(searchQuery) || category.includes(searchQuery);
            });
        }

        function formatMatchDate(timestamp) {
            const d = new Date(timestamp);
            const now = new Date();
            const isToday = d.toDateString() === now.toDateString();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const isTomorrow = d.toDateString() === tomorrow.toDateString();
            const dateStr = isToday ? "Today" : isTomorrow ? "Tomorrow" : d.toLocaleDateString("en-US", { month: "short", day: "numeric" });
            const timeStr = d.toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit", hour12: true });
            return { date: dateStr, time: timeStr };
        }

        function isLive(timestamp) {
            const now = Date.now();
            return timestamp <= now && now - timestamp < 3 * 60 * 60 * 1000;
        }

        function highlight(text) {
            if (!searchQuery) return text;
            const escaped = searchQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const cls = isDark() ? 'bg-yellow-500 text-gray-900 rounded px-0.5' : 'bg-yellow-200 rounded px-0.5';
            return text.replace(new RegExp(`(${escaped})`, 'gi'), `<mark class="${cls}">$1</mark>`);
        }

        function renderMatches() {
            const grid = document.getElementById("matches-grid");
            const filtered = getFilteredMatches();
            const dark = isDark();

            if (filtered.length === 0) {
                const msg = searchQuery
                    ? `No matches found for "<strong>${searchQuery}</strong>".`
                    : "No matches found for this sport.";
                grid.innerHTML = `<p class="col-span-full text-center ${dark ? 'text-gray-400' : 'text-gray-500'} py-8">${msg}</p>`;
                return;
            }

            const card = dark ? "bg-gray-900 border-gray-800" : "bg-white border-gray-200";
            const vsColor = dark ? "text-gray-500" : "text-gray-400";
            const metaColor = dark ? "text-gray-400" : "text-gray-500";
            const chevron = dark ? "text-gray-600" : "text-gray-300";

            grid.innerHTML = filtered.map(match => {
                const { date, time } = formatMatchDate(match.date);
                const live = isLive(match.date);
                const homeName = match.teams?.home?.name || match.title.split(" vs ")[0] || match.title;
                const awayName = match.teams?.away?.name || match.title.split(" vs ")[1] || "";
                const homeBadge = match.teams?.home?.badge;
                const awayBadge = match.teams?.away?.badge;
                const categoryColor = categoryColors[match.category] || "bg-blue-600";
                const timeChip = live ? "bg-red-100 text-red-700" : (dark ? "bg-blue-900 text-blue-300" : "bg-blue-50 text-blue-700");

                return `
                    <div onclick="showMatchDetail('${match.id}')" class="${card} p-4 rounded-lg border cursor-pointer hover-elevate active-elevate-2 transition-all group flex items-start gap-3">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1.5 flex-wrap">
                                ${homeBadge ? `<img src="${API_BASE}/images/badge/${homeBadge}.webp" alt="${homeName}" class="w-6 h-6 object-contain flex-shrink-0" onerror="this.style.display='none'">` : ""}
                                <span class="font-semibold text-sm truncate">${highlight(homeName)}</span>
                                <span class="text-xs ${vsColor}">vs</span>
                            </div>
                            <div class="flex items-center gap-2 mb-2 flex-wrap">
                                ${awayBadge ? `<img src="${API_BASE}/images/badge/${awayBadge}.webp" alt="${awayName}" class="w-6 h-6 object-contain flex-shrink-0" onerror="this.style.display='none'">` : ""}
                                <span class="font-semibold text-sm truncate">${highlight(awayName)}</span>
                                ${live ? `<span class="bg-red-600 text-white text-[10px] px-1.5 py-0 rounded flex items-center gap-1 animate-pulse"><i data-lucide="radio" class="w-3 h-3"></i> LIVE</span>` : ""}
                            </div>
                            <div class="flex items-center gap-2 flex-wrap">
                                <span class="inline-flex items-center text-[10px] font-bold text-white px-2 py-0.5 rounded-md ${categoryColor}">
                                    ${match.category.toUpperCase()}
                                </span>
                                <div class="flex items-center gap-1 text-xs ${metaColor}">
                                    <i data-lucide="clock" class="w-3 h-3"></i>
                                    <span>${date}</span>
                                    <span class="font-semibold px-1.5 py-0.5 rounded text-[10px] ${timeChip}">${time}</span>
                                </div>
                            </div>
                        </div>
                        <i data-lucide="chevron-right" class="w-5 h-5 ${chevron} flex-shrink-0 mt-2 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                    </div>
                `;
            }).join("");
            lucide.createIcons();
        }

        async function showMatchDetail(matchId) {
            const match = matches.find(m => m.id === matchId);
            if (!match) return;

            const modal = document.getElementById("match-modal");
            const content = document.getElementById("modal-content");
            modal.classList.remove("hidden");
            const dark = isDark();

            const pulse = dark ? "bg-gray-800" : "bg-gray-200";
            content.innerHTML = `
                <div class="animate-pulse space-y-4">
                    <div class="h-8 ${pulse} rounded w-3/4"></div>
                    <div class="h-48 ${pulse} rounded w-full"></div>
                    <div class="space-y-2">
                        <div class="h-4 ${pulse} rounded w-1/2"></div>
                        <div class="h-4 ${pulse} rounded w-1/3"></div>
                    </div>
                </div>
            `;

            try {
                const source = match.sources[0]?.source || "default";
                const id = match.sources[0]?.id || match.id;
                const res = await fetch(`${API_BASE}/stream/${source}/${id}`);
                const streams = await res.json();

                const homeName = match.teams?.home?.name || match.title.split(" vs ")[0] || match.title;
                const awayName = match.teams?.away?.name || match.title.split(" vs ")[1] || "";
                const sub = dark ? "text-gray-400" : "text-gray-500";
                const btnClass = dark ? "border-gray-700 hover:bg-gray-800 text-gray-200" : "border-gray-200 hover:bg-gray-50 text-gray-700";
                const btnSub = dark ? "text-gray-500" : "text-gray-400";
                const divider = dark ? "border-gray-800" : "border-gray-200";
                const label = dark ? "text-gray-500" : "text-gray-400";
                const noStreamBg = dark ? "bg-gray-800" : "bg-gray-100";
                const noStreamIcon = dark ? "text-gray-600" : "text-gray-300";

                content.innerHTML = `
                    <div class="space-y-6">
                        <div class="text-center">
                            <h2 class="text-xl font-bold mb-2">${homeName} vs ${awayName}</h2>
                            <p class="text-sm ${sub}">${match.title}</p>
                        </div>

                        ${streams.length > 0 ? `
                            <div class="aspect-video bg-black rounded-lg overflow-hidden">
                                <iframe id="stream-player" src="${streams[0].embedUrl}" class="w-full h-full" frameborder="0" allowfullscreen></iframe>
                            </div>
                            <div class="space-y-3">
                                <h3 class="font-semibold text-sm">Select Stream</h3>
                                <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                                    ${streams.map(s => `
                                        <button onclick="switchStream('${s.embedUrl}')"
                                            class="px-3 py-2 border rounded-lg text-xs transition-colors flex flex-col items-center gap-1 ${btnClass}">
                                            <span class="font-bold">Stream ${s.streamNo}</span>
                                            <span class="${btnSub}">${s.language} ${s.hd ? '(HD)' : ''}</span>
                                        </button>
                                    `).join("")}
                                </div>
                            </div>
                        ` : `
                            <div class="aspect-video ${noStreamBg} rounded-lg flex items-center justify-center flex-col gap-2">
                                <i data-lucide="video-off" class="w-12 h-12 ${noStreamIcon}"></i>
                                <p class="${sub}">No streams available for this match.</p>
                            </div>
                        `}

                        <div class="border-t ${divider} pt-6">
                            <h3 class="font-semibold text-sm mb-3">Match Info</h3>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="${label}">Category</p>
                                    <p class="font-medium capitalize">${match.category}</p>
                                </div>
                                <div>
                                    <p class="${label}">Date</p>
                                    <p class="font-medium">${new Date(match.date).toLocaleString()}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                lucide.createIcons();
            } catch (err) {
                console.error("Failed to load stream", err);
                content.innerHTML = `<p class="text-center text-red-500">Failed to load stream details.</p>`;
            }
        }

        function switchStream(url) {
            document.getElementById("stream-player").src = url;
        }

        function closeModal() {
            document.getElementById("match-modal").classList.add("hidden");
            document.getElementById("modal-content").innerHTML = "";
        }

        window.onclick = function(event) {
            const modal = document.getElementById("match-modal");
            if (event.target == modal) closeModal();
        }

        init();
    </script>
</body>
</html>
